{"uid":"a89e618ba16f35a6","name":"Remove feats, parens, and accents","fullName":"tests.test_getplaylist.TestNormalization#test_normalize_logic","historyId":"207b87da7cb725271a240222d7fa16bc","time":{"start":1765370124613,"stop":1765370124613,"duration":0},"status":"broken","statusMessage":"TypeError: normalize() argument 2 must be str, not MagicMock","statusTrace":"@pytest.fixture(scope=\"module\")\n    def playlist_module():\n        \"\"\"\n        Safely imports 'getplaylist' by mocking the environment it needs\n        (Google Sheets request, file system, etc.) ONLY during the import.\n        \"\"\"\n        # 1. Prepare Mock Response for Google Sheets\n        mock_response = MagicMock()\n        mock_response.text = \"Header,Song,Artist\\n1,Wonderwall,Oasis\\n2,Song 2,Blur\"\n        mock_response.raise_for_status = MagicMock()\n    \n        # 2. Context Manager for all side-effects\n        # We mock 'builtins.open' here just for the import execution.\n        with patch('requests.get', return_value=mock_response), \\\n             patch('os.path.isdir', return_value=True), \\\n             patch('os.listdir', return_value=['Oasis - Wonderwall.mp3', 'Blur - Song 2.mp3']), \\\n             patch('builtins.open', new_callable=mock_open) as m_open, \\\n             patch.dict(sys.modules, {'mutagen': MagicMock(), 'mutagen.easyid3': MagicMock()}):\n    \n            # 3. Import or Reload the module\n            if 'getplaylist' in sys.modules:\n                import useful_tools.getplaylist as getplaylist\n                importlib.reload(getplaylist)\n            else:\n>               import useful_tools.getplaylist as getplaylist\n\ntests/test_getplaylist.py:31: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nuseful_tools/getplaylist.py:135: in <module>\n    m_artist, m_title = safe_read_easyid3(fpath)\n                        ^^^^^^^^^^^^^^^^^^^^^^^^\nuseful_tools/getplaylist.py:102: in safe_read_easyid3\n    return normalize(artist), normalize(title)\n           ^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ns = <MagicMock name='mock.EasyID3().get().__getitem__()' id='139793275711248'>\n\n    def normalize(s: str) -> str:\n        \"\"\"Lowercase, strip accents, remove extra punctuation/whitespace, collapse features.\"\"\"\n        if not s:\n            return ''\n>       s = unicodedata.normalize('NFKD', s)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       TypeError: normalize() argument 2 must be str, not MagicMock\n\nuseful_tools/getplaylist.py:35: TypeError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"playlist_module","time":{"start":1765370124590,"stop":1765370124603,"duration":13},"status":"broken","statusMessage":"TypeError: normalize() argument 2 must be str, not MagicMock\n","statusTrace":"  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n          ^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/_pytest/setuponly.py\", line 36, in pytest_fixture_setup\n    return (yield)\n            ^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/_pytest/fixtures.py\", line 1202, in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/_pytest/fixtures.py\", line 908, in call_fixture_func\n    fixture_result = next(generator)\n                     ^^^^^^^^^^^^^^^\n  File \"/home/runner/work/jukebox2/jukebox2/tests/test_getplaylist.py\", line 31, in playlist_module\n    import useful_tools.getplaylist as getplaylist\n  File \"/home/runner/work/jukebox2/jukebox2/useful_tools/getplaylist.py\", line 135, in <module>\n    m_artist, m_title = safe_read_easyid3(fpath)\n                        ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/jukebox2/jukebox2/useful_tools/getplaylist.py\", line 102, in safe_read_easyid3\n    return normalize(artist), normalize(title)\n           ^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/jukebox2/jukebox2/useful_tools/getplaylist.py\", line 35, in normalize\n    s = unicodedata.normalize('NFKD', s)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"afterStages":[],"labels":[{"name":"story","value":"Cleanup"},{"name":"feature","value":"Normalization"},{"name":"suite","value":"Data Cleaning"},{"name":"epic","value":"Playlist Sync"},{"name":"parentSuite","value":"tests"},{"name":"subSuite","value":"TestNormalization"},{"name":"host","value":"runnervmoqczp"},{"name":"thread","value":"2559-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_getplaylist"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"expected","value":"'jay-z'"},{"name":"input_str","value":"'Jay-Z feat. Alicia Keys'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":9,"skipped":0,"passed":0,"unknown":0,"total":9},"items":[{"uid":"652c0ec05488375a","reportUrl":"https://TonyJayHunt.github.io/jukebox2/41/#testresult/652c0ec05488375a","status":"broken","statusDetails":"TypeError: normalize() argument 2 must be str, not MagicMock","time":{"start":1765226830069,"stop":1765226830069,"duration":0}},{"uid":"e648de61ecdb26ba","reportUrl":"https://TonyJayHunt.github.io/jukebox2/40/#testresult/e648de61ecdb26ba","status":"broken","statusDetails":"TypeError: normalize() argument 2 must be str, not MagicMock","time":{"start":1765225659058,"stop":1765225659058,"duration":0}},{"uid":"e37206be95ce296","reportUrl":"https://TonyJayHunt.github.io/jukebox2/39/#testresult/e37206be95ce296","status":"broken","statusDetails":"TypeError: normalize() argument 2 must be str, not MagicMock","time":{"start":1765225571867,"stop":1765225571867,"duration":0}},{"uid":"2caf4ac4844d00e1","reportUrl":"https://TonyJayHunt.github.io/jukebox2/38/#testresult/2caf4ac4844d00e1","status":"broken","statusDetails":"TypeError: normalize() argument 2 must be str, not MagicMock","time":{"start":1765103664944,"stop":1765103664944,"duration":0}},{"uid":"8642b214c1b96035","reportUrl":"https://TonyJayHunt.github.io/jukebox2/37/#testresult/8642b214c1b96035","status":"broken","statusDetails":"TypeError: normalize() argument 2 must be str, not MagicMock","time":{"start":1764504653403,"stop":1764504653403,"duration":0}},{"uid":"7e67367c5cca820c","reportUrl":"https://TonyJayHunt.github.io/jukebox2/36/#testresult/7e67367c5cca820c","status":"broken","statusDetails":"TypeError: normalize() argument 2 must be str, not MagicMock","time":{"start":1764504641272,"stop":1764504641272,"duration":0}},{"uid":"19f6673bc4f8cab6","reportUrl":"https://TonyJayHunt.github.io/jukebox2/35/#testresult/19f6673bc4f8cab6","status":"broken","statusDetails":"TypeError: normalize() argument 2 must be str, not MagicMock","time":{"start":1764504441785,"stop":1764504441785,"duration":0}},{"uid":"24afb8ecb078b680","reportUrl":"https://TonyJayHunt.github.io/jukebox2/34/#testresult/24afb8ecb078b680","status":"broken","statusDetails":"TypeError: normalize() argument 2 must be str, not MagicMock","time":{"start":1764504236172,"stop":1764504236172,"duration":0}}]},"tags":[]},"source":"a89e618ba16f35a6.json","parameterValues":["'jay-z'","'Jay-Z feat. Alicia Keys'"]}